<%- include('partials/head.ejs') %>

<link rel="stylesheet" href="/css/questsStyles.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>

<body>
<main>
    <div id="headingContainer">
        <div id="navigationContainer">
            <form action="/home">
                <button id="homeBtn">Home</button>
            </form>
            <form action="/quests">
                <button id="questsBtn">Back to Quests</button>
            </form>
        </div>

        <h1>GameQuest Tracker</h1>

        <!-- Logout -->
        <form action="/logout">
            <button id="logoutBtn">Logout</button>
        </form>
    </div>

    <h2>Edit Quest</h2>

    <!-- Edit Quest Form -->
    <div id="editQuestForm" class="quest-form">
        <form action="/quest/update/<%= quest.quest_id %>" method="POST">
            <!-- Quest Name (TEXT input) -->
            <label for="questName">Quest Name:</label>
            <input type="text" id="questName" name="questName" value="<%= quest.quest_name %>" maxlength="100" required>

            <!-- Quest Description (TEXTAREA) -->
            <label for="questDesc">Description:</label>
            <textarea id="questDesc" name="questDesc" rows="4" maxlength="500" required><%= quest.quest_desc %></textarea>

            <!-- Difficulty (RADIO buttons) -->
            <label>Difficulty:</label>
            <div class="radio-group">
                <label>
                    <input type="radio" name="difficulty" value="easy" <%= quest.difficulty === 'easy' ? 'checked' : '' %>> Easy
                </label>
                <label>
                    <input type="radio" name="difficulty" value="medium" <%= quest.difficulty === 'medium' ? 'checked' : '' %>> Medium
                </label>
                <label>
                    <input type="radio" name="difficulty" value="hard" <%= quest.difficulty === 'hard' ? 'checked' : '' %>> Hard
                </label>
            </div>

            <!-- Status (SELECT dropdown) -->
            <label for="status">Status:</label>
            <select id="status" name="status">
                <option value="not_started" <%= quest.status === 'not_started' ? 'selected' : '' %>>Not Started</option>
                <option value="in_progress" <%= quest.status === 'in_progress' ? 'selected' : '' %>>In Progress</option>
                <option value="completed" <%= quest.status === 'completed' ? 'selected' : '' %>>Completed</option>
            </select>

            <!-- Started Date (DATE input) -->
            <label for="startedAt">Started Date:</label>
            <input type="date" id="startedAt" name="startedAt" value="<%= quest.started_at ? quest.started_at.toISOString().split('T')[0] : '' %>">

            <!-- Completed Date (DATE input) -->
            <label for="endedAt">Completed Date:</label>
            <input type="date" id="endedAt" name="endedAt" value="<%= quest.ended_at ? quest.ended_at.toISOString().split('T')[0] : '' %>">

            <div class="quest-info">
                <p><strong>Game:</strong> <span id="gameName">Loading...</span></p>
                <p><strong>Created:</strong> <%= quest.created_at ? quest.created_at.toISOString().split('T')[0] : 'N/A' %></p>
            </div>

            <div class="button-group">
                <button type="submit" class="primary-btn">Update Quest</button>
                <button type="button" id="deleteQuestBtn" class="danger-btn">Delete Quest</button>
            </div>
        </form>
    </div>

    <!-- Hidden Delete Form -->
    <form id="deleteForm" action="/quest/delete/<%= quest.quest_id %>" method="POST" style="display: none;">
        <input type="hidden" name="questId" value="<%= quest.quest_id %>">
    </form>
</main>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" id="deleteModal">
    <div class="modal-container">
        <div class="modal-header">
            <h3 class="modal-title">Confirm Deletion</h3>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete this quest?</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="secondary-btn" id="cancelDeleteBtn">Cancel</button>
            <button type="button" class="danger-btn" id="confirmDeleteBtn">Delete</button>
        </div>
    </div>
</div>

<!-- Footer -->
<%- include('partials/footer.ejs') %>

<!-- Scripts -->
<script>
  const questId = <%= quest.quest_id %>;
  const gameId = <%= quest.game_id %>;
</script>

<script src="/js/questDetailsScript.js"></script>
</body>
</html>